<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#007AFF">
    <title>Goalaroo - Track Your Child's Progress</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icons/favicon-32x32.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Goalaroo">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Enhanced Progress Ring SVG Definitions -->
    <svg style="display: none;">
        <defs>
            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#00C7BE"/>
                <stop offset="100%" style="stop-color:#007AFF"/>
            </linearGradient>
            <linearGradient id="successGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#34C759"/>
                <stop offset="100%" style="stop-color:#2F855A"/>
            </linearGradient>
        </defs>
    </svg>
</head>
<body>
    <!-- Authentication Screen -->
    <div id="auth-screen" class="screen">
        <div class="auth-container">
            <div class="enhanced-logo">
                <div class="logo-container">
                    <div class="logo-emoji">ü¶ò</div>
                </div>
                <h1>Goalaroo</h1>
                <p class="tagline">Transform goals into adventures! <span class="sparkle">üéâ</span></p>
                <p class="subtitle">Make progress tracking fun for kids with interactive stories and rewards</p>
            </div>

            <!-- Enhanced Feature Preview Section -->
            <div class="enhanced-auth-container">
                <div class="feature-preview">
                    <div class="feature-card">
                        <span class="feature-icon">üéØ</span>
                        <h3>Interactive Goals</h3>
                        <p>Turn daily tasks into exciting adventures with story-driven progress tracking</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                        <h3>Family Friendly</h3>
                        <p>Manage multiple children's goals with personalized avatars and themes</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">üìä</span>
                        <h3>Progress Insights</h3>
                        <p>Track streaks, celebrate milestones, and build positive habits together</p>
                    </div>
                </div>
            </div>
            
            <div class="enhanced-auth-container">
                <div class="enhanced-auth-form">
                    <div class="form-header">
                        <h2>Welcome Back</h2>
                        <p>Enter your email to get started</p>
                    </div>
                    <input type="email" id="email" class="enhanced-input" placeholder="Enter your email" required>
                    <button id="send-code-btn" class="enhanced-btn">
                        <span class="btn-icon">‚ú®</span>
                        Send Magic Code
                    </button>
                </div>

                <div id="code-section" class="enhanced-auth-form" style="display: none;">
                    <div class="form-header">
                        <h2>Almost There!</h2>
                        <p>Check your email for the magic code</p>
                    </div>
                    <input type="text" id="code" class="enhanced-input" placeholder="Enter 6-digit code" maxlength="6">
                    <button id="verify-code-btn" class="enhanced-btn">
                        <span class="btn-icon">üîê</span>
                        Verify Code
                    </button>
                </div>
            </div>

            <div class="auth-footer">
                <span class="sparkle">üåà</span> Welcome to a world of positive goals!
                <div id="dev-mode-indicator" style="display: none; margin-top: 10px; padding: 8px 12px; background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 6px; font-size: 12px; color: #856404;">
                    üõ†Ô∏è Development Mode - Magic codes will be shown in console
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboard" class="screen" style="display: none;">
        <header class="enhanced-header">
            <div class="header-top">
                <div class="app-brand">
                    <span class="app-icon">ü¶ò</span>
                    <h1 class="app-title">Goalaroo</h1>
                </div>
                <div class="user-controls">
                    <span id="user-email" class="user-email"></span>
                    <button id="logout-btn" class="btn-icon" title="Logout">
                        <span>üö™</span>
                    </button>
                </div>
            </div>
            <div class="enhanced-child-selector">
                <div id="child-avatars" class="child-avatars">
                    <!-- Enhanced child avatars will be rendered here -->
                </div>
            </div>
        </header>

        <main class="dashboard-main">
            <!-- Enhanced Goals Container -->
            <div class="enhanced-goals-container">
                <div class="goals-header">
                    <div class="goals-title">
                        <h2>Goals</h2>
                        <span class="goals-count" id="goals-count">0 goals</span>
                    </div>
                    <button id="add-goal-btn" class="add-goal-btn">
                        <span class="btn-icon">‚ûï</span>
                        <span>Add Goal</span>
                    </button>
                </div>
                <div id="goals-container" class="goals-list">
                    <!-- Enhanced goal cards will be rendered here -->
                </div>
            </div>
        </main>
        
        <footer class="dashboard-footer">
            <div class="footer-content">
                <span class="app-version">v${APP_VERSION}</span>
            </div>
        </footer>
    </div>

    <!-- Enhanced Add Child Modal -->
    <div id="add-child-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Child</h3>
                <button class="close-btn" onclick="window.GoalarooEnhancements ? window.GoalarooEnhancements.hideModal('add-child-modal') : hideModal('add-child-modal')">‚úï</button>
            </div>
            <form id="add-child-form" class="enhanced-form">
                <div class="form-group">
                    <label for="child-name">Child's Name</label>
                    <input type="text" id="child-name" name="name" class="enhanced-input" required>
                </div>
                <div class="form-group">
                    <label>Choose Avatar</label>
                    <div class="enhanced-icon-picker" id="add-child-avatar">
                        <!-- Avatars will be added dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Choose Color</label>
                    <div class="enhanced-color-picker" id="add-child-color">
                        <!-- Colors will be added dynamically -->
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="window.GoalarooEnhancements ? window.GoalarooEnhancements.hideModal('add-child-modal') : hideModal('add-child-modal')">Cancel</button>
                    <button type="submit" class="enhanced-btn">
                        <span class="btn-icon">‚ú®</span>
                        Add Child
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Child Modal -->
    <div id="edit-child-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Child</h3>
                <button class="close-btn" onclick="hideModal('edit-child-modal')">‚úï</button>
            </div>
            <form id="edit-child-form">
                <div class="form-group">
                    <label for="edit-child-name">Child's Name</label>
                    <input type="text" id="edit-child-name" name="name" required>
                </div>
                <div class="form-group">
                    <label>Choose Avatar</label>
                    <div class="icon-picker" id="edit-child-avatar">
                        <!-- Avatars will be added dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Choose Color</label>
                    <div class="color-picker" id="edit-child-color">
                        <!-- Colors will be added dynamically -->
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideModal('edit-child-modal')">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Goal Modal -->
    <div id="add-goal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Goal</h3>
                <button class="close-btn" onclick="hideModal('add-goal-modal')">‚úï</button>
            </div>
            <form id="add-goal-form">
                <div class="form-group">
                    <label for="goal-name">Goal Name</label>
                    <input type="text" id="goal-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="goal-type">Goal Type</label>
                    <select id="goal-type" name="type" required>
                        <option value="daily">Daily Goal</option>
                        <option value="weekly">Weekly Goal</option>
                        <option value="timer">Timer Goal</option>
                    </select>
                </div>
                
                <!-- Daily/Weekly Goal Options -->
                <div class="form-group" id="recurring-options" style="display: none;">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="goal-repeat" name="repeat">
                            Repeat automatically
                        </label>
                    </div>
                </div>
                
                <!-- Timer Goal Options -->
                <div class="form-group" id="timer-options" style="display: none;">
                    <label for="timer-duration">Duration</label>
                    <div class="duration-input">
                        <input type="number" id="timer-duration" name="duration" min="1" placeholder="e.g., 30">
                        <select id="timer-unit" name="unit">
                            <option value="minutes">Minutes</option>
                            <option value="hours">Hours</option>
                        </select>
                    </div>
                </div>
                



                <div class="form-group">
                    <label>Choose Color</label>
                    <div class="color-picker" id="goal-color">
                        <!-- Colors will be added dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Choose Children</label>
                    <div id="goal-children" class="child-multiselect">
                        <!-- Child options will be added dynamically -->
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideModal('add-goal-modal')">Cancel</button>
                    <button type="submit" class="btn-primary">Create Goal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Goal Modal -->
    <div id="edit-goal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Goal</h3>
                <button class="close-btn" onclick="hideModal('edit-goal-modal')">‚úï</button>
            </div>
            <form id="edit-goal-form">
                <div class="form-group">
                    <label for="edit-goal-name">Goal Name</label>
                    <input type="text" id="edit-goal-name" name="name" required>
                </div>
                
                <!-- Daily/Weekly Goal Options -->
                <div class="form-group" id="edit-recurring-options" style="display: none;">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="edit-goal-repeat" name="repeat">
                            Repeat automatically
                        </label>
                    </div>
                </div>
                
                <!-- Timer Goal Options -->
                <div class="form-group" id="edit-timer-options" style="display: none;">
                    <label for="edit-timer-duration">Duration</label>
                    <div class="duration-input">
                        <input type="number" id="edit-timer-duration" name="duration" min="1" placeholder="e.g., 30">
                        <select id="edit-timer-unit" name="unit">
                            <option value="minutes">Minutes</option>
                            <option value="hours">Hours</option>
                        </select>
                    </div>
                </div>
                

                
                <div class="form-group">
                    <label>Choose Color</label>
                    <div class="color-picker" id="edit-goal-color">
                        <!-- Colors will be added dynamically -->
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="hideModal('edit-goal-modal')">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Goal Detail Modal -->
    <div id="goal-detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Goal Details</h3>
                <button class="close-btn" onclick="hideModal('goal-detail-modal')">‚úï</button>
            </div>
            <div class="modal-body">
                <!-- Goal details will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Enhanced Completion History Modal -->
    <div id="completion-history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Completion History</h3>
                <button class="close-btn" onclick="window.GoalarooEnhancements ? window.GoalarooEnhancements.hideModal('completion-history-modal') : hideModal('completion-history-modal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="enhanced-completion-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-number" id="total-completions">0</div>
                        <div class="stat-label">Total Completions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-number" id="current-streak">0</div>
                        <div class="stat-label">Current Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-number" id="longest-streak">0</div>
                        <div class="stat-label">Longest Streak</div>
                    </div>
                </div>
                
                <div class="enhanced-completion-filters">
                    <button class="filter-btn active" data-filter="all">All Time</button>
                    <button class="filter-btn" data-filter="week">This Week</button>
                    <button class="filter-btn" data-filter="month">This Month</button>
                </div>
                
                <div class="enhanced-completion-insights" id="completion-insights" style="display: none;">
                    <h4>üìà Insights</h4>
                    <div class="insights-grid">
                        <div class="insight-item">
                            <div class="insight-icon">üìä</div>
                            <div class="insight-label">Average per day</div>
                            <div class="insight-value" id="avg-per-day">-</div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-icon">üåü</div>
                            <div class="insight-label">Best day</div>
                            <div class="insight-value" id="best-day">-</div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-icon">üìù</div>
                            <div class="insight-label">Notes added</div>
                            <div class="insight-value" id="notes-count">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="enhanced-completion-list" id="completion-list">
                    <!-- Completion history will be populated dynamically -->
                </div>
                
                <div class="enhanced-completion-empty" id="completion-empty" style="display: none;">
                    <div class="empty-icon">üìä</div>
                    <h4>No completions yet</h4>
                    <p>Complete this goal to see your progress history!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Notification Container -->
    <div id="notification-container" style="position: fixed; top: var(--space-6); right: var(--space-6); z-index: 10000; pointer-events: none;">
        <!-- Notifications will be inserted here -->
    </div>

    <!-- Enhanced Templates -->
    
<!-- Replace the existing Enhanced Goal Card Template -->
<template id="enhanced-goal-card-template">
    <div class="enhanced-goal-card" data-goal-id="">
        <div class="goal-header">
            <div class="goal-title-section">
                <h3 class="goal-name"></h3>
                <div class="goal-child-info">
                    <!-- Child avatar will be inserted here -->
                </div>
            </div>
            <div class="goal-actions">
                <button class="action-btn view" title="View Details" onclick="openGoalDetail(this.dataset.goalId)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </button>
                <button class="action-btn history" title="View History" onclick="openCompletionHistory(this.dataset.goalId)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3v5h5"></path>
                        <path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"></path>
                        <path d="M12 7v5l4 2"></path>
                    </svg>
                </button>
                <button class="action-btn edit" title="Edit Goal" onclick="editGoal(this.dataset.goalId)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="m18.5 2.5 a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </button>
                <button class="action-btn complete" title="Complete Goal" onclick="window.GoalarooEnhancements ? window.GoalarooEnhancements.completeGoal(this.dataset.goalId) : completeGoal(this.dataset.goalId)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <path d="M20 6L9 17l-5-5"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="goal-progress-section">
            <div class="progress-circle-container">
                <svg class="progress-ring" viewBox="0 0 120 120">
                    <circle cx="60" cy="60" r="50" class="progress-track"/>
                    <circle cx="60" cy="60" r="50" class="progress-bar"/>
                </svg>
                <div class="progress-center">
                    <span class="progress-emoji"></span>
                </div>
            </div>
            <div class="progress-info">
                <div class="progress-percentage"></div>
                <div class="progress-encouragement"></div>
            </div>
        </div>

        <div class="story-trail-section">
            <div class="story-header">
                <h4 class="story-title"></h4>
                <p class="story-description"></p>
            </div>
            <div class="trail-visual">
                <div class="trail-progress-bar">
                    <div class="trail-character"></div>
                </div>
            </div>
            <div class="trail-milestones">
                <!-- Milestones will be inserted here -->
            </div>
        </div>
    </div>
</template>

<!-- Enhanced Empty State Template -->
<template id="enhanced-empty-state-template">
    <div class="enhanced-empty-state">
        <div class="empty-icon-container">
            <div class="empty-icon">üéØ</div>
            <div class="empty-icon-glow"></div>
        </div>
        <h3>Ready for Adventure?</h3>
        <p>Create your first goal to start an exciting journey! Turn everyday tasks into magical adventures with progress tracking that kids love.</p>
        <button class="enhanced-cta-btn" onclick="window.GoalarooEnhancements ? window.GoalarooEnhancements.showModal('add-goal-modal') : showModal('add-goal-modal')">
            <span class="btn-shimmer"></span>
            <span class="btn-content">
                <span class="btn-icon">‚ú®</span>
                <span class="btn-text">Create First Goal</span>
            </span>
        </button>
    </div>
</template>

<!-- Enhanced Child Avatar Template -->
<template id="enhanced-child-avatar-template">
    <div class="child-avatar-container" data-child-id="">
        <div class="child-avatar-emoji">
            <span class="child-emoji"></span>
        </div>
        <div class="child-avatar-name"></div>
        <button class="child-avatar-edit-btn" onclick="openEditChildModal(this.dataset.child)">
            ‚úèÔ∏è
        </button>
    </div>
</template>


<!-- Enhanced Completion Item Template -->
<template id="enhanced-completion-item-template">
    <div class="enhanced-completion-item">
        <div class="completion-icon">
            <span class="completion-emoji">‚úÖ</span>
        </div>
        <div class="completion-details">
            <div class="completion-date"></div>
            <div class="completion-time"></div>
            <div class="completion-notes"></div>
        </div>
        <div class="completion-meta">
            <div class="completion-by"></div>
            <div class="completion-celebration">üéâ</div>
        </div>
    </div>
</template>

<!-- Enhanced Loading Template -->
<template id="enhanced-loading-template">
    <div class="enhanced-loading-state">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
        <div class="loading-text">Loading your goals...</div>
    </div>
</template>

<!-- Enhanced Notification Template -->
<template id="enhanced-notification-template">
    <div class="enhanced-notification" data-type="success">
        <div class="notification-content">
            <span class="notification-icon">‚úÖ</span>
            <span class="notification-text"></span>
            <button class="notification-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
        </div>
    </div>
</template>

    <!-- Script to add at the end of body, before app.js -->
<script>
    // Apply enhanced classes immediately when DOM loads
    (function() {
        'use strict';
        
        // Apply enhanced classes to auth container
        function enhanceAuthScreen() {
            const authContainer = document.querySelector('.auth-container');
            if (authContainer) {
                // Find all auth form containers and add enhanced class
                const authForms = authContainer.querySelectorAll('.auth-form, .verify-form');
                authForms.forEach(form => {
                    if (!form.classList.contains('enhanced-auth-container')) {
                        form.classList.add('enhanced-auth-container');
                    }
                });
            }
        }
        
        // Apply enhanced classes to dashboard
        function enhanceDashboard() {
            const dashboardHeader = document.querySelector('.dashboard-header');
            if (dashboardHeader) {
                dashboardHeader.classList.add('enhanced-header');
            }
            
            const childSelector = document.querySelector('.child-selector, .header-top + div');
            if (childSelector) {
                childSelector.classList.add('enhanced-child-selector');
            }
            
            const goalsContainer = document.querySelector('.goals-container');
            if (goalsContainer) {
                goalsContainer.classList.add('enhanced-goals-container');
            }
        }
        
        // Apply enhanced classes to inputs and buttons
        function enhanceFormElements() {
            document.querySelectorAll('input[type="email"], input[type="text"], input[type="number"], input[type="password"]').forEach(input => {
                if (!input.classList.contains('enhanced-input')) {
                    input.classList.add('enhanced-input');
                }
            });
            
            document.querySelectorAll('.btn-primary').forEach(btn => {
                if (!btn.classList.contains('enhanced-btn')) {
                    btn.classList.add('enhanced-btn');
                }
            });
        }
        
        // Initialize on DOM content loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                enhanceAuthScreen();
                enhanceDashboard();
                enhanceFormElements();
                
                // Re-apply enhancements when screens change
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            // Screen visibility changed
                            setTimeout(() => {
                                enhanceAuthScreen();
                                enhanceDashboard();
                                enhanceFormElements();
                            }, 100);
                        }
                    });
                });
                
                // Observe auth and dashboard screens
                const authScreen = document.getElementById('auth-screen');
                const dashboardScreen = document.getElementById('dashboard');
                
                if (authScreen) {
                    observer.observe(authScreen, { attributes: true });
                }
                if (dashboardScreen) {
                    observer.observe(dashboardScreen, { attributes: true });
                }
            });
        } else {
            enhanceAuthScreen();
            enhanceDashboard();
            enhanceFormElements();
        }
    })();
    </script>
    
    <!-- Network Status -->
    <div id="network-status" class="status online" style="position: fixed; top: 10px; right: 10px; z-index: 1000; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
        üü¢ Online
    </div>

    <!-- Load version information -->
    <script src="version.js"></script>
    
    <!-- Main application script -->
    <script src="app.js"></script>
</body>
</html>
